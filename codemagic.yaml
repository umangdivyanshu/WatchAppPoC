# Automatically generated on 2021-07-30 UTC from https://codemagic.io/app/6103899fd885ed998448eb42/settings
# Note that this configuration is not an exact match to UI settings. Review and adjust as necessary.

workflows:
  iOSFirebase-workflow:
    name: Web Workflow
    max_build_duration: 30
    environment:
      vars:
        GCLOUD_KEY_FILE: Encrypted(ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAi
                          d2F0Y2hhcHB0ZXN0LTU4MjAyMSIsCiAgInByaXZhdGVfa2V5X2lkIjogIjY0ODFh
                          OTdkMWZjYzc1YTM1NWJhYzEwZDI5YzUwZTQ1ODc1MDczOTciLAogICJwcml2YXRl
                          X2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2QUlCQURB
                          TkJna3Foa2lHOXcwQkFRRUZBQVNDQktZd2dnU2lBZ0VBQW9JQkFRQzRXMk9GcG5B
                          c3lrMnJcbmdGMlRleTlMaUVaVU0vL2xLemlVUDlONjlMZE5JM0o1c2d0YjVGTCtx
                          V2xleUNWYmdXYUNpOGVVRHdEUFdIakJcbnM5K2p4UHE5RHBzZjJUM2F0d0xLMkZ3
                          Y1RMelRGdDEvZTZHS3pQb0FnUTQ5VnRXaTRlNnJGMVMyL1I4aU5jaDlcbmszenFB
                          b2UrdWNENjlibm55cUUva2MyT0x6Uy8zbGxuMWluN28rdkYzWVFxUURod1F4RHdP
                          Tmttd1BaeXh3VlRcbk1Ia3c4eXRlYkQ4dE93SjdrenBMMUMzWGVLUHpEL2xtMHZy
                          ZHBtSGRGWlB2c1MySk9IU2lkc2laMDU2bFNDRW5cbjZUVEJ0ak0yUDcwaWVSekNR
                          WFVSSXZzYWY0eEozbm5EcHFZNytGTWxpRGEzUk5YZFhzZzlVTklMNmtwVTVSNkJc
                          bkMvd1M1NjBOQWdNQkFBRUNnZ0VBQWxEbzc5V1JkSWxEYnpONCtYdFlzc0xrTDB2
                          MVJsOFpUTjRvWi81ZkRIeGZcbmhIYUtKMU5pVk45ZFVEQXZncURJNER4UCs0K0hX
                          NzRwZGpXRG43NXFiLzd1VC9qSXRYdGdjTy93UGFMR2Z5MjdcbkJxT2srZVlZQUoy
                          ZWNpMS9HRUZ0Q3RVMk0rajdmOUNHZmtnTFpRZmh4Z2IyRFFabjd0T0szR09XaU5k
                          cSt1WVRcblptQ2lPZlYra2hRSkJDTmlxcHR5b0ZleXg1Qng1UE16dnhYcERBQ00y
                          a0kzbVBGcTU1aUVvM2hkNmxyaC9TemxcbnJyZmpZMkZSblRYUUhUTTBtUm9VdFpz
                          V283VXZPRWtScWFZN3hqU3pKeXphbjA4LzBoekhnRlZjOHg1c2UzN3NcblJzVDNk
                          Z3EvdEVGN2N6M3A2VlladVlucmdNbjFCVXR3SVdtRTMrZ0p1UUtCZ1FEckgxYmNk
                          b1dLY0hoZ2w0dmtcbngwTFlNemczVGU3cXFFMGRaRFdqWVpEcjJJaHdVQUFRU0pG
                          d1A5NjVlWUQ5QnpZNkcxTUxOZ09NRU81cldob3ZcbjllTlVIZGYrMEVRdm9RM1Nn
                          cCthWjV0TTVFY3ZGMms2UzBnUmxyVERpUjhZSmxEbWdab25RSTNFeFlBVllPemVc
                          bkkwSVBCUzE5WUlhV1JzVDZWTlBpckZQQUV3S0JnUURJdWhTUnZaWnhPR1RNZFZv
                          ZEpWWjc5dkVtdlg0T1FseXJcblVPMGM3OWlOQVJtL1h4ZFhDbG5RUk51SEFYbnR5
                          NmNjRW13QTRUL2JiK0dEUk1DQ3hBcVA3Y2NpRFREVVZtNWFcblBOalBmUDAvNkVD
                          TDYyTVI3THZ4dnZzd0tiaDNzQkpQWFFZMHFyZFUyZlpsR2ppRUZpVGtjbjhLM0s4
                          M0ZoRXdcbkkyb3NjVWZDWHdLQmdBMW5RL1JkYlU5dkNlMjN0ZW5jMGhxeEVNdFdU
                          Z0JpaDhMZEs1R2N4ajRyb2R1Rk0vdTVcbnAxRFcwME9QZ2FMcS9sUmhxbUpCT2dL
                          S0ZJMWFIWlFPV0Y4N05FejZZbWkwcmEwS2RUN0FHVUpRNFIzMkg3R0xcbkNSaTNs
                          cVp1OHE3VndGYmpuSDRRV0FTWG5hMmFVT1o0N0JNZklIQzlSKzdaS2ZGN1ZIamZp
                          Z2F4QW9HQWFFUllcbnlQZmRmUVNaUDZlNTNxZjFpOEZUdFJiN3N2Wi80ckhQNlpj
                          aE91V1dkVlUwNzQ2OTVyVE9BQXdoUlFmanoyNDJcblVpS3ZwQkl5NTVoQUUrMDN1
                          MW45ZGMrNlRLSjFBa1RYTHJpemFJNEJjVzBkY2tNeHdicStDbCt4cGVKOU1HS1hc
                          bkJhYWtRdHhSNUdUQmRNTjMrSDhOUlJ3cm5BYkhlT1Q4a3dkcENpc0NnWUFwUTRl
                          ZVE2VW5xYXZoMGZvQkIyYnVcbm9XUTdVTmI5Z1FSbjUydmdCc052MWxEU0RoNDRO
                          RkVKeHhYajFPck1JcEVxRkRONjUvL2M2YnFaYSt2UUIzM2tcblFoeTRZbkIweFVV
                          ZUZlcmp1WG5rakZ1M0pFdWdJY2tPN2M5NVNXVlQ1RjJ5Vyt1WEJ5eEV5UWRSckZY
                          K1NKRTJcbkxUMkwvTWJvbTVwaE5Cem1zSzFseVE9PVxuLS0tLS1FTkQgUFJJVkFU
                          RSBLRVktLS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogImZpcmViYXNlLWFkbWlu
                          c2RrLXNhY3FmQHdhdGNoYXBwdGVzdC01ODIwMjEuaWFtLmdzZXJ2aWNlYWNjb3Vu
                          dC5jb20iLAogICJjbGllbnRfaWQiOiAiMTEzNjMzOTQxNDcwOTQ4NDgwMzk1IiwK
                          ICAiYXV0aF91cmkiOiAiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL28vb2F1
                          dGgyL2F1dGgiLAogICJ0b2tlbl91cmkiOiAiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xl
                          YXBpcy5jb20vdG9rZW4iLAogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwi
                          OiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwK
                          ICAiY2xpZW50X3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBp
                          cy5jb20vcm9ib3QvdjEvbWV0YWRhdGEveDUwOS9maXJlYmFzZS1hZG1pbnNkay1z
                          YWNxZiU0MHdhdGNoYXBwdGVzdC01ODIwMjEuaWFtLmdzZXJ2aWNlYWNjb3VudC5j
                          b20iCn0K)
        APP_STORE_CONNECT_ISSUER_ID: 513ca88c-1377-4dba-9b28-45e7db34f510
        APP_STORE_CONNECT_KEY_IDENTIFIER: 4KSMTR6432
        APP_STORE_CONNECT_PRIVATE_KEY: Encrypted(Z0FBQUFBQmhFSjB0NGltY0QzX21kNlZfRlpmWXI1RnlHTjVPZ1ozTWRmdi1SZThHejBfa04zaDEzWlRZeVRvM3Ryd3JsNzA5Vk92M0EzWm9fVDdpUlF1S3lZWUktenZJT2lNMjNjRjZLbkZPVHAtWjRsSzBsRFJ1TW1hLXRDWFlITUNrSGtfMUlqS245VTJyR0lQakZzR2FUOXVHZUZBRmV1Z0ktRHljMGFIcDR2SjU0cVhXNHlWX2c4UUxIZ3RCYVdFTW1mMldObTFhaTh6LWFZTG9aWVdWY2hxLS13X2FxQXVWTk1vQ29RV1RUWXhhbm1qUnd4em01Nl9LN1JxTmtHeEFMSkMyc0RwSUVZb2o0aloycUhLdnlTdVYxWVFJY0pFZDJEOGtDalZuWFJZcHV6THBlbGthRGFZZlBEV2RjekFoeTVTeTFvVW9VZEc0T0FtLWRnOTdQVW1KNlRZRVJ0YktXc1J6Z3ZxTEVLeExhd1FWbDBRaHNnSlNuenY2NGhqd3RnMGU5eVRKWC1iU1JObzE1Y1VUaXIzVjBoUVBncFZHS01fOVEwbUkxRG01dUl3aEJDcz0=)
        CERTIFICATE_PRIVATE_KEY: Encrypted(Z0FBQUFBQmhFSjB0MGtONFh6dFB4aEx1Sm5zUDduanA0dHVZSElEQ2ZxaEptYkRGLWFUTE04NFdpaENDamV4QlIya0FwcmJsOTVYZ1FqSXJOZHJpS2JlYjRHUFZDNkhvY0lyaEkzX2dSNUhBWUk3Znc2eVRyUHUyMkd1NmhJMGJGNjRkTEhySkZnOXg5N3Vya05zTENiT2x2ajBlUXRZOWswMEpIWFllUmlHYmRsUlRZLXlic1U4cXp2dloyNjRBU0VpeW9BZTZfYzMycE85eE9KcWlkVlQteDRfRU1rYnZSdFBWUEJJQmQ0Zy1BZFJtVFlnSDU3R0xBQlpTTloxbUlfTlA4WkZKYzA5VklraDNLZGIzczJ5RDU4M0ZVNTcxVjNJTHRwTzJwalUtREluT05hYmJOZHViT1lJWklTOVpmNjFtcUlNOWxPNTNkaGRoblZTeGJDbEFyRVIydkFxUl9sYUFUbFhQd0dDYkt5eUhBZFFZd09hbXl2dzh4TVFwNlNKbm1lRHBJcjFJSm91T0doU1dXNDhXVElyb0NoejBRZjY5Z1V5SEFXanlwT1pJZUJuQUFnU1AyRGZlZzlpSkdDRm5fbVpiRTBuN2NDaG9jeHJ1cEM3eG84VFllNklKdG1pUE9pejZDdmVVQ2pSREY0elNabEY2TkhDNEp4QUVrOERzRjg1cVBQNDc3bjR6eGFfN3lmd0NaOW5KM1BNOGE0MmFuM0IwM2lmU2w0Tm5xLURnSDMzNmpJRTBPOXZRMmJNSHNRUXdZUGdLSmpNOE5YOGtzNVNPSUtQRFIzcTJZM1YwaUFndjN1SUZ2RFhwcXdQYm1zazEwWmdQYzl4clp1MG56YmFWMUpQRTR0QmI5STFEYlJTVDh5QXdSMERPbExMZTZoX0NHS294bEhabTBobkRpU3Z6c2lRVWJ3LW5Ba01RVlhtM00xSnJWVEZUNWtiRmRZSFY1c2MxZmJTN3hxNnZxVFhJUVZ0NXp0a2NWbkNOdkplMy1aM0wybUxrUTBEOWJwNUhETTBHOVFzNkM1RzhuYXY5T0hhZUhmTzdkNHRCQmE4UWFuN29lOUtkRzI2SEhtM3ZaT25PSzdLWnpuVFhRbTZVQ2ZfZFByMWdmR205TmRlZmJSWHRLaE52VWljb283djNTQ25RVURuRkVRbDFJQ01TWF9fTm9VZXRPR2JFYmNnaVY4V3FueWdjQWRaaGNDTEtrelVVTkhPdGltMzdfTzN6SlUwOVBDREtkbE1VTzhKdHJpcjJidFdhaHFSeEtoSFVMeklBWnljbW5TUklRZDNyRXdNNF9nZENra05faWZQZHhoVm45WnQ5NmhXcnA3eXlPT09JZ0xkX1RFS1N4Tzd1TUd4SEs4dDBOLVVSQ3BvV0JRQUNPdFdsTXJjckVMbU5heXpWeG5IejZ0Q3FlUHRfc0s5UWpsR21Wd1JESnFBWmhXZkd5MDRrdFhmZTdXaVJ0TC1la2ZFc0JrYzBrNjJoX2EwbEl0MW5KcW9vREVISVVhbnFDWFlvNktkNGVZR19RUUxKSzJNNk5GeEQ5X1VEOHZhbzE3NXc2bFRqSDBGUm0xWjV2bkw5S2JCTW1LSlVxOUF3TlpVd0dLQmVDYXhfaC1SVTlqWWZNZHZTajcxYXhTeHNiSU50eTRHak5zSVBLbWxfdjR5QTdXV2Z2ZnVRRVVCclZ6eGFlak4xVDliX2F0TXJUR1l1QkFScGwxWTRhWE8zcEVmRHJaRHljNlQ2SE9tcmx6aGZzSGphUDNnR3pjcTloTHh3NnNkd3ppdmhoWXdBamM3NTVBblBydkdhTVIxT0Itb1JkWHpLWHc0UzdDVG5ENGU2WXB6YnhkRkVBd1l3ZkVWRG1UajY3YzVTYjY1aWRfUTN0eGxHSlVuOXB3Q1ZzOFd3c1Nrb055dnM5bk5BUThSbHNqYUlINHVhRG5VOWc5cDc2RGFWOG56aV9FZW1qTDJDaE00bjlxQ0VRdUxNN2R2c0xRLVc2amROQUcySUZVTWlkOU94al9adUZlR2IxMDJmaTdLbkNlajBTVVl5M0tzSW5sdTVvbFBBdUJNRGRjVFBKblotdDZ1eEYxSFNVY0phWC1BZVVodFJOSGxDUWNVcF9LeWt1ZzF1enlrVjZRek5iS3NDSGJlNXcxaU8wU2J2SVpqRTRNck1Wei13TmRIclNDYnh5VDFETzViN2s1N0FSMV9EYWt4R1RXWWNGR1JjOUNQSkIwU3NfcjZEbldlSEFxT2VzeUd5cHNodkg5ekJPSm9TWlhRdVRmc2hIeUxwVXpFc1ZTaEh4aldPS2tsUlZtZFl6blBsTEI4U21JaTVMTTRWNUpoc2pJM1lXSXZpbTQ5Y1dRNWJzT3Iyd0VCUVlwZk9CSGJ2emxvR1M2a1puajZIZ0xxSWdTYnc4d0F0bDJxU21ONWFlVExFamthdzFWUnQ5aUJOSy1qMERRdlFQVUpCczNGRkFoWUVxdGh4WDU3ZVlOM21EM3pVMi1NOVZsd1MydXg4YkpZcGRGOUViTG16OG1wMEJXVHN4T0hkZzltQ1dMODMtb1o1U3lDSFI2N1ZXeUxfV3ZrRVZ0VXpoTXlHMlJYWUFHbGlrMTdBR3BWUVFWUGY4aWJvajVSMUFQd3IwSUlhQ3I1TFBmeTI1eFMwTTR0OHBNQThhZmx1X0M0WUZQVVloWkk3NmxjMEd1a1oyeUlNaVNGNDU1ZjZtME80YjZ5LWdOX0RyZkZIalQ0WTEyMkoxVW05Y0RHMUJlUjUxcUh1RWtMSlotbWRGMGl1REgxOVRvdFIxa0VjNlpRS0NZbzgxSmI3TDJiWThZVGRhMTluMFBnVVBSakJlU0gtYnRrY3h4SXd2a0J6SjBuclN1NzV2TnhBbGVNZ0lvQzJadkQzaGtid2tXVnh5b3k0dmp4V01nMUJoNUZsSVl5ZC1BT29XR0ZUZWtLSndZZkRJUDJuSHlqcEZkeldKVUZnNTZWelNsZ0wxMlppN3p4ZXQtc3dsNl9maE9jTnlVUXh6Qk1LVF9fMExLYVVrTVowT0JFQlJHN2tiX0N0TVBLM292eEVuUGpC)
      flutter: stable
      xcode: latest
      cocoapods: default
    scripts:
      - name: 'AppStore Connect and Pod install'
        script: |
          flutter packages pub get
          find . -name "Podfile" -execdir pod install \;
      - name: 'Initialize Keychain'
        script: |
          keychain initialize
      - name: 'Fetch Signing Files'
        script: |
          app-store-connect fetch-signing-files $(xcode-project detect-bundle-id) --type IOS_APP_STORE --create
      - name: 'Add Certificate'
        script: |
          keychain add-certificates
      - name: 'Setup code signing settings on xcode project'
        script: |
          xcode-project use-profiles
      - name: 'Execute integration test on Firebase'
        script: |
          output="../build/ios_integ"
          product="build/ios_integ/Build/Products"
          dev_target="14.5"
          echo "Flutter Build Started For iOS"
          echo `pwd`
          flutter build ios integration_test/app_test.dart --debug --codesign
          echo "Starting xcode Build..."
          pushd ios
          echo `pwd`
          xcodebuild -allowProvisioningUpdates -workspace Runner.xcworkspace -scheme Runner -config Flutter/Debug.xcconfig -derivedDataPath $output -sdk iphoneos build-for-testing
          popd

          echo "Preparing the zip"
          pushd $product
          echo `pwd`
          echo "Listing the directory..."
          echo `ls`
          xctestrun=$(ls Runner*.xctestrun)
          zip -r "ios_tests.zip" "Release-iphoneos" $xctestrun
          popd

          echo $GCLOUD_KEY_FILE | base64 --decode > ./gcloud_key_file.json

          gcloud auth activate-service-account --key-file=gcloud_key_file.json

          gcloud --quiet config set project watchapppoc-9e24e

          gcloud firebase test ios run --test "build/ios_integ/Build/Products/ios_tests.zip" --device model=iphone8,version=13.6,locale=en_US,orientation=portrait --timeout 5m

    artifacts:
      - build/**/outputs/**/mapping.txt
      - flutter_drive.log
    publishing:
      email:
        recipients:
          - udivyanshu8@gmail.com
          - narayansiddharth@gmail.com